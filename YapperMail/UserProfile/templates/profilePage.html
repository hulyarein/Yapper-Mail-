{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- bootstrapshiz -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/logo2.png' %}"
    />
    <title>Yapper | Profile</title>
  </head>
  <body class="bg-[#F4F4F4]">
    {% include 'components/header.html' %}

    <div
      class="title flex flex-row gap-10 justify-center items-center flex-wrap-reverse"
    >
      <div class="mx-11 lg:mx-0">
        <label class="font-mono font-bold text-6xl lg:text-7xl"
          >Personal Info</label
        >
        <h3>Manage how the world sees you</h3>
      </div>
      <img src="{% static 'images/cuteImage.png' %}" alt="" />
    </div>

    <div class="content pb-20 flex flex-col items-center">
      <div
        class="personalInfo border-2 border-[#F37D84] my-10 flex flex-col w-4/5 lg:w-3/5 rounded-3xl"
      >
        <div class="flex items-center m-6">
          <label class="font-sans text-3xl mx-10">Personal Info</label>
        </div>
        <hr class="border-[#F37D84] border-2" />
        <a href="" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <div class="profilePic p-6 flex justify-between items-center">
            <label class="lg:mx-10 font-medium">Profile Picture</label>
            <img
              src="{{ profilepic }}"
              alt="nayeon"
              class="rounded-full h-16 w-16 lg:mx-10"
            />
          </div>
        </a>
        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeName' %}">
          <div class="name p-6 flex justify-between items-center">
            <div class="flex content-between">
              <div class="lg:ml-10 w-20 lg:w-40">
                <label class="font-medium lg:mr-0">Name</label>
              </div>
              <label class="font-medium truncate block w-32 lg:w-96"
                >{{ first_name }} {{ middle_name }} {{ last_name }}</label
              >
            </div>
            {% include 'components/arrowsvg.html' %}
          </div>
        </a>
        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeBday' %}">
          <div class="name p-6 flex justify-between items-center">
            <div class="flex content-between">
              <div class="lg:ml-10 w-20 lg:w-40">
                <label class="font-medium lg:mr-0">Birthday</label>
              </div>
              <label class="font-medium">{{ birthday }}</label>
            </div>
            {% include 'components/arrowsvg.html' %}
          </div>
        </a>

        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeGender' %}">
          <div class="rounded-b-3xl">
            <div class="name p-6 flex justify-between items-center">
              <div class="flex content-between">
                <div class="lg:ml-10 w-20 lg:w-40">
                  <label class="font-medium lg:mr-0">Gender</label>
                </div>
                <label class="font-medium truncate block w-32 lg:w-96"
                  >{{ gender }}</label
                >
              </div>
              {% include 'components/arrowsvg.html' %}
            </div>
          </div>
        </a>
      </div>

      <div
        class="contactInfo border-2 border-[#F37D84] my-10 w-4/5 lg:w-3/5 rounded-3xl"
      >
        <div class="flex items-center m-6">
          <label class="font-sans text-3xl mx-10">Contact Information</label>
        </div>
        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeNumber' %}">
          <div class="hover:bg-[#e9e7e7]">
            <div class="name p-6 flex justify-between items-center">
              <div class="flex content-between">
                <div class="lg:ml-10 w-20 lg:w-40">
                  <label class="font-medium lg:mr-0">
                    Phone<span class="block lg:inline"> Number</span></label
                  >
                </div>
                <label class="font-medium">{{ phone_number }}</label>
              </div>
              {% include 'components/arrowsvg.html' %}
            </div>
          </div>
        </a>

        <hr class="border-[#F37D84] border-2" />
        <div class="hover:bg-[#e9e7e7] rounded-b-3xl">
          <div class="name p-6 flex justify-between items-center">
            <div class="flex content-between">
              <div class="lg:ml-10 w-20 lg:w-40">
                <label class="font-medium lg:mr-0">Email Address</label>
              </div>
              <label class="font-medium truncate block w-32 lg:w-96"
                >{{ email_address }}</label
              >
            </div>
          </div>
        </div>
      </div>

      <div
        class="addresses border-2 border-[#F37D84] my-10 w-4/5 lg:w-3/5 rounded-3xl"
      >
        <div class="flex items-center m-6">
          <label class="font-sans text-3xl mx-10">Addresses</label>
        </div>
        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeHome' %}">
          <div class="hover:bg-[#e9e7e7]">
            <div class="name p-6 flex justify-between items-center">
              <div class="flex content-between">
                <div class="lg:ml-10 w-20 lg:w-40">
                  <label class="font-medium lg:mr-0">Home</label>
                </div>
                <label class="font-medium truncate block w-32 lg:w-96"
                  >{{ home_address }}</label
                >
              </div>
              {% include 'components/arrowsvg.html' %}
            </div>
          </div>
        </a>

        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changeWork' %}">
          <div class="hover:bg-[#e9e7e7] rounded-b-3xl">
            <div class="name p-6 flex justify-between items-center">
              <div class="flex content-between">
                <div class="lg:ml-10 w-20 lg:w-40">
                  <label class="font-medium lg:mr-0">Work</label>
                </div>
                <label class="font-medium truncate block w-32 lg:w-96"
                  >{{ work_address }}</label
                >
              </div>
              {% include 'components/arrowsvg.html' %}
            </div>
          </div>
        </a>
      </div>

      <div
        class="addresses border-2 border-[#F37D84] my-10 w-4/5 lg:w-3/5 rounded-3xl"
      >
        <div class="flex items-center m-6">
          <label class="font-sans text-3xl mx-10">Security</label>
        </div>
        <hr class="border-[#F37D84] border-2" />
        <a href="{% url 'changePassword' %}">
          <div class="hover:bg-[#e9e7e7] rounded-b-3xl">
            <div class="name p-6 flex justify-between items-center">
              <div class="flex content-between">
                <div class="lg:ml-10 w-20 lg:w-40">
                  <label class="font-medium lg:mr-0">Password</label>
                </div>
                <label class="font-medium"></label>
              </div>
              {% include 'components/arrowsvg.html' %}
            </div>
          </div>
        </a>
      </div>

      <button
        type="button"
        class="btn btn-danger w-4/5 lg:w-3/5"
        data-bs-toggle="modal"
        data-bs-target="#deleteAccountModal"
      >
        Delete Account
      </button>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const deleteModal = document.getElementById("deleteAccountModal");

          if (deleteModal) {
            deleteModal.addEventListener("shown.bs.modal", function () {
              const passwordInput = document.getElementById("deletePassword");
              const confirmInput = document.getElementById("deleteConfirm");
              const deleteLink = document.getElementById("deleteAccountBtn");
              const form = document.getElementById("deleteForm");
              const errorMessagesDiv = document.getElementById("errorMessages");

              form.reset();
              deleteLink.disabled = true;

              passwordInput.value = "";
              confirmInput.value = "";
              errorMessagesDiv.style.display = "none"; // Hide errors by default

              function displayError(message) {
                errorMessagesDiv.innerText = message;
                errorMessagesDiv.style.display = "block";
              }

              function validateFields() {
                if (
                  passwordInput.value.trim() !== "" &&
                  confirmInput.value.trim() !== ""
                ) {
                  deleteLink.onclick = function (event) {
                    event.preventDefault();

                    if (confirmInput.value.trim() !== "Yapper/{{ user }}") {
                      displayError("The confirmation text does not match.");
                      return;
                    }

                    const formData = new FormData(form);
                    fetch(form.action, {
                      method: "POST",
                      body: formData,
                      headers: {
                        "X-Requested-With": "XMLHttpRequest",
                      },
                    })
                      .then((response) => response.json())
                      .then((data) => {
                        if (data.success) {
                          window.location.href = "/";
                        } else {
                          displayError(data.error || "An error occurred.");
                        }
                      })
                      .catch(() => {
                        displayError(
                          "An unexpected error occurred. Please try again."
                        );
                      });
                  };
                } else {
                  deleteLink.classList.add("disabled");
                  deleteLink.setAttribute("aria-disabled", "true");
                  deleteLink.onclick = function () {
                    displayError("Please fill in all fields.");
                  };
                }
              }

              // Hide error messages and validate fields on input
              passwordInput.addEventListener("input", function () {
                errorMessagesDiv.style.display = "none";
                validateFields();
              });
              confirmInput.addEventListener("input", function () {
                errorMessagesDiv.style.display = "none";
                validateFields();
              });
            });
          }
        });
      </script>

      <div
        class="modal fade"
        id="deleteAccountModal"
        tabindex="-1"
        aria-labelledby="deleteAccountModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div
              class="model-header flex flex-col justify-between mt-8 mx-5 mb-2"
            >
              <h1 class="text-3xl text-[#FF0000] font-bold">Delete Account</h1>
              <p>This action is irreversible.</p>
            </div>

            <div class="model-contents flex flex-col justify-between mx-5 mb-5">
              <form
                action="{% url 'profile' %}"
                class="flex flex-col gap-3"
                id="deleteForm"
              >
                {% csrf_token %}
                <input type="hidden" name="delete_account" value="1" />

                <div class="flex flex-col gap-2">
                  <div
                    class="alert alert-danger"
                    id="errorMessages"
                    style="display: none"
                    role="alert"
                  ></div>
                  <div class="flex flex-col">
                    <label class="text-lg font-semibold">Password</label>
                    <input
                      type="password"
                      class="p-3 border-2 border-[#f37d84] focus:border-[#f66f78] focus:ring-1 focus:ring-[#f37d84] rounded-lg focus:outline-none w-full"
                      name="password"
                      id="deletePassword"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label class="text-lg font-semibold">Confirmation</label>
                    <p>Please type the confirmation shown below</p>
                    <input
                      type="text"
                      class="p-3 border-2 border-[#f37d84] focus:border-[#f66f78] focus:ring-1 focus:ring-[#f37d84] rounded-lg focus:outline-none w-full"
                      name="deleteConfirm"
                      id="deleteConfirm"
                      placeholder="Yapper/{{ user }}"
                    />
                  </div>
                </div>
                <div class="flex justify-end gap-10 items-center">
                  <a
                    class="font-semibold hover:font-medium"
                    id="deleteAccountBtn"
                    aria-disabled="true"
                    ><label>Delete</label></a
                  >
                  <button
                    type="button"
                    data-bs-dismiss="modal"
                    class="btn btn-primary w-[100px] font-semibold rounded-3xl bg-[#F37D84] border-[#F37D84] hover:bg-[#f66f78] hover:border-[#f66f78] h-12 disabled:bg-gray-400 disabled:border-[#BDBDBD]"
                    id="openModal"
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      {% include 'components/changeProfilePic.html' %}
    </div>
    <!-- bootstrapshiz-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@floating-ui/core@1.6.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.11"></script>
  </body>
</html>
